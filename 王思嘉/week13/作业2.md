# 股票助手chatbi接口文档

## 项目概述

该项目是一个股票助手chatbi，可以进行交互对话，股票查询等内容。后端基于FastAPI框架开发，提供RESTful API接口供前端调用。

- 基础url:`http://localhost:8000`

## 接口列表
**总计：46个接口**（32个API接口 + 14个MCP接口）

- 用户管理：7个接口
- 聊天功能：6个接口
- 数据管理：4个接口
- 股票收藏：4个接口
- MCP协议接口：14个接口（运行在8900端口，支持SSE模式）
- 股票行情API：10个接口（双重用途接口，挂载在 `/stock`路径下）

## 1.用户管理接口
### 1.1 用户登录
- 接口路径：`POST/v1/user/login`
- 描述：实现用户登录功能
- 文件目录：`routers/user.py`
- 函数名：`user-login`
- 请求体：
```json
{
    "user_name": "string", // 用户名
    "password": "string"  // 密码
}
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
}
```

### 1.2 用户注册
- 接口路径：`POST/v1/user/register`
- 描述：实现用户注册功能
- 文件目录：`routers/user.py`
- 函数名：`user-register`
- 请求体：
```json
{
    "user_name": "string", // 用户名
    "password": "string",  // 密码
    "user_role": "string"  // 用户身份
}
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
}
```

### 1.3 密码重置
- 接口路径：`POST/v1/user/reset-password`
- 描述：实现用户密码重置功能
- 文件目录：`routers/user.py`
- 函数名：`user_reset_password`
- 请求体：
```json
{
    "user_name": "string", // 用户名
    "password": "string"  // 密码   
}
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
}
```

### 1.4 获取用户信息
- 接口路径：`POST/v1/user/info`
- 描述：实现获取用户信息功能
- 文件目录：`routers/user.py`
- 函数名：`user_info`
- 请求体参数：
```
    "user_name": "string"
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {             // 用户信息
      "user_id": 0,
      "user_name": "string",
      "user_role": "string",
      "register_time": "2025-01-01T00:00:00",
      "status": true
    }
}
```

### 1.5 修改用户信息
- 接口路径：`POST/v1/user/reset-info`
- 描述：实现用户信息修改功能
- 文件目录：`routers/user.py`
- 函数名：`user_reset_info`
- 请求体：
```json
{
    "user_name": "string", // 用户名
    "user_role": "string", // 用户身份（可选）
    "status": true         // 用户状态（可选）   
}
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
}
```

### 1.6 删除用户信息
- 接口路径：`POST/v1/user/delete`
- 描述：实现用户信息删除功能
- 文件目录：`routers/user.py`
- 函数名：`user_delete`
- 请求参数：
```
    "user_name": "string" // 用户名
```
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
}
```

### 1.7 获取用户列表
- 接口路径：`POST/v1/user/list`
- 描述：实现获取用户列表功能
- 文件目录：`routers/user.py`
- 函数名：`user_list`
- 响应体：
```json
{
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {             // 用户列表
        "user_id": 0,
        "user_name": "string",
        "user_role": "string",
        "register_time": "2025-01-01T00:00:00",
        "status": true
    }
}
```
## 2.聊天功能接口
### 2.1 聊天交互接口
- 接口路径：`POST/v1/chat`
- 描述：实现同用户的聊天交互
- 文件目录：`routers/chat.py`
- 函数名：`chat`
- 请求体：
 ```json
  {
    "content": "string",            // 用户提问内容
    "user_name": "string",         // 用户名
    "session_id": "string",        // 对话会话ID（可选）
    "task": "string",              // 对话任务（可选）
    "tools": ["string"],           // 可选工具列表（可选）
    "image_content": "string",     // 图片内容（可选）
    "file_content": "string",      // 文件内容（可选）
    "url_content": "string",       // URL内容（可选）
    "audio_content": "string",     // 音频内容（可选）
    "video_content": "string",     // 视频内容（可选）
    "vison_mode": false,            // 视觉模式（可选）
    "deepsearch_mode": false,       // 深度搜索模式（可选）
    "sql_interpreter": false,       // SQL解释器模式（可选）
    "code_interpreter": false       // 代码解释器模式（可选）
  }
  ```
- 响应：AI进行流式输出即可

### 2.2 初始化聊天内容
- 接口路径：`POST/v1/chat/init`
- 描述：聊天内容初始化（创建新的对话）
- 文件目录：`routers/chat.py`
- 函数名：`init_chat`
- 响应：
```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {
      "session_id": "string"  // 生成的会话ID
    }
  }
  ```

  ### 2.3 获取聊天内容 
- 接口路径：`POST/v1/chat/get`
- 描述：获取同ai对话内容
- 文件目录：`routers/chat.py`
- 函数名：`get_chat`
- 请求参数：
    "session_id": "string"
- 响应：
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {             // 会话数据
      "session_id": "string",
      "messages": [
        {
          "message_id": 0,
          "content": "string",
          "sender": "string",
          "timestamp": "2023-01-01T00:00:00"
        }
      ]
    }
  }
  ```

  ### 2.4 删除聊天内容  
- 接口路径：`POST/v1/chat/delete`
- 描述：删除同对话内容
- 文件目录：`routers/chat.py`
- 函数名：`delete_chat`
- 请求参数：
    "session_id": "string"
- 响应体：
 ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

   ### 2.5 获取对话列表  
- 接口路径：`POST/v1/chat/list`
- 描述：删除同对话内容
- 文件目录：`routers/chat.py`
- 函数名：`list_chat`
- 请求参数：
    "username": "string"
- 响应体：
 ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": [             // 聊天会话列表
      {
        "session_id": "string",
        "title": "string",
        "start_time": "2025-01-01T00:00:00",
        "feedback": true,
        "feedback_time": "2025-01-01T00:00:00"
      }
    ]
  }
  ```

   ### 2.6 获取聊天反馈  
- 接口路径：`POST/v1/chat/feedback`
- 描述：删除同对话内容
- 文件目录：`routers/chat.py`
- 函数名：`feedback_chat`
- 请求参数：
    "session_id": "string"
    "message_id": "integer"
    "feedback": "boolean"
- 响应体：
 ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```  
## 3.数据管理接口(此部分未完成，有自己设计的部分，待修改)
  ### 3.1 数据下载  
- 接口路径：`POST/v1/data/download`
- 描述：实现股票数据下载功能
- 文件目录：`routers/data.py`
- 函数名：`download_data`
- 请求参数：
    "stock_id": "string"
    "start_date": "string"
    "end_date": "string"
   
- 响应体：
 根据需要下载csv文件或图片文件

   ### 3.2 数据创建  
- 接口路径：`POST/v1/data/create`
- 描述：实现股票数据下载功能
- 文件目录：`routers/data.py`
- 函数名：`create_data`
- 请求参数：
  ```json
  {
    "user_name": "string",
    "data_name": "string",
    "stock_tags": "list(string)"
  } 
  ```
- 响应体：
 ```json
  {
  "code": 200,
  "message": "string",
  "data": {
    "watchlist_id": "integer",
    "name": "string",    
    "created_at": "2025-01-15T10:30:00Z"
  }
}
```

   ### 3.3 数据上传  
- 接口路径：`POST/v1/data/upload`
- 描述：实现数据上传功能
- 文件目录：`routers/data.py`
- 函数名：`upload_data`
- 请求参数：
    "file": "file"
    "user_name": "string"
- 响应体：
 ```json
  {
  "code": 200,
  "message": "string",
  "data": []    //待定
}
```

   ### 3.4 数据删除  
- 接口路径：`POST/v1/data/delete`
- 描述：实现数据删除功能
- 文件目录：`routers/data.py`
- 函数名：`delete_data`
- 响应体：
 ```json
  {
  "code": 200,
  "message": "string",
  "data": []    
}
```

## 4.股票接口
   ### 4.1 用户关注股票数据获取  
- 接口路径：`POST/v1/stock/list_fav_stock`
- 描述：实现用户关注股票数据获取
- 文件目录：`routers/stock.py`
- 函数名：`get_user_all_stock`
- 请求体：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": [             // 收藏的股票列表
      {
        "stock_code": "string",
        "create_time": "2025-01-01T00:00:00"
      }
    ]
  }
  ```

  ### 4.2 用户关注股票数据删除  
- 接口路径：`POST/v1/stock/del_fav_stock`
- 描述：实现用户关注股票数据删除
- 文件目录：`routers/stock.py`
- 函数名：`delete_user_all_stock`
- 请求体：
  `user_name`: 用户名
  `stock_code`: 股票代码
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ```  

  ### 4.3 用户关注股票数据添加 
- 接口路径：`POST/v1/stock/add_fav_stock`
- 描述：实现用户关注股票数据添加
- 文件目录：`routers/stock.py`
- 函数名：`add_user_all_stock`
- 请求体：
  `user_name`: 用户名
  `stock_code`: 股票代码
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ```
  ### 4.4 用户关注股票数据清空  
- 接口路径：`POST/v1/stock/clear_fav_stock`
- 描述：实现用户关注股票数据清空
- 文件目录：`routers/stock.py`
- 函数名：`clear_user_all_stock`
- 请求体：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ```  
## 5.股票数据查询接口
  ### 5.1 股票查询
- 接口路径：`GET/stock/get_stock_code`
- 描述：实现股票数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_all_stock_code`
- 请求参数：
  `keyword`: 代码、名称查询
- 响应体:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 股票列表数据
      {
        "code": "000001",        // 股票代码
        "name": "平安银行",       // 股票名称
        "industry": "银行"        // 所属行业
      },
      ...
    ]
  }
  ```

  ### 5.2 指数查询 
- 接口路径：`GET/stock/get_index_code`
- 描述：实现指数信息查询
- 文件目录：`api/autostock.py`
- 函数名：`get_all_index_code`
- 响应体:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 指数列表数据
      {
        "code": "000001.SH",     // 指数代码（含市场标识）
        "name": "上证指数"        // 指数名称
      }
    ]
  }
  ``` 

  ### 5.3 板块数据查询 
- 接口路径：`GET/stock/get_industry_code`
- 描述：实现板块数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_industry_code`
- 响应体:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 行业列表数据
      {
        "code": "BK0001",        // 行业代码
        "name": "银行"            // 行业名称
      }
    ]
  }
  ``` 

  ### 5.4 大盘数据查询 
- 接口路径：`GET/stock/get_board_info`
- 描述：实现大盘数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_board_info`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

  ### 5.5 股票排行查询 
- 接口路径：`GET/stock/get_stock_rank`
- 描述：实现股票排行查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_rank`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

  ### 5.6 股票月k查询
- 接口路径：`GET/stock/get_month_line`
- 描述：实现月k数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_month_kline`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ```    

  ### 5.7 股票周k查询 
- 接口路径：`GET/stock/get_week_line`
- 描述：实现周k数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_week_kline`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

  ### 5.8 股票日k查询 
- 接口路径：`GET/stock/get_day_line`
- 描述：实现日k数据查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_day_kline`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

  ### 5.8 股票基础信息查询 
- 接口路径：`GET/stock/get_stock_info`
- 描述：实现基础信息查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_info`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

  ### 5.9 股票分时信息查询 
- 接口路径：`GET/stock/get_stock_minute_data`
- 描述：实现分时信息查询
- 文件目录：`api/autostock.py`
- 函数名：`get_stock_minute_data`
- 请求参数：
  `user_name`: 用户名
- 响应体:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []             // 收藏的股票列表
  }
  ``` 

## 6.新闻接口(MCP)
  ### 6.1 今日新闻获取
- 描述：实现今日新闻查询
- 文件目录：`api/news.py`
- 函数名：`get_today_daily_news`
- 响应: 返回今日新闻列表
  
  ### 6.2 抖音热点获取
- 描述：实现抖音热点查询
- 文件目录：`api/news.py`
- 函数名：`get_douyin_hot_news`
- 响应: 返回今日抖音热点列表
    
  ### 6.3 github热点获取
- 描述：实现github新闻查询
- 文件目录：`api/news.py`
- 函数名：`get_github_hot_news`
- 响应: 返回今日github热点列表
    
  ### 6.4 头条热点获取
- 描述：实现头条新闻查询
- 文件目录：`api/news.py`
- 函数名：`get_toutiao_hot_news`
- 响应: 返回今日头条热点列表
    
  ### 6.5 运动热点获取
- 描述：实现运动新闻查询
- 文件目录：`api/news.py`
- 函数名：`get_sports_news`
- 响应: 返回今日运动热点列表
    

## 7.工具接口(MCP)
  ### 7.1 城市天气获取
- 描述：实现城市天气查询
- 文件目录：`api/news.py`
- 函数名：`get_city_weather`
- 响应参数：`city_name`: 城市名称
- 响应: 返回今日天气信息 

  ### 7.2 地点信息获取
- 描述：实现地点信息查询
- 文件目录：`api/news.py`
- 函数名：`get_address_detail`
- 响应参数：`address_text`: 地点名称
- 响应: 返回地点信息 

  ### 7.3 电话信息获取
- 描述：实现城市天气查询
- 文件目录：`api/news.py`
- 函数名：`get_tel_info`
- 响应参数：`tel_no`: 电话号码
- 响应: 返回电话信息

  ### 7.4 旅游信息获取
- 描述：实现旅游信息查询
- 文件目录：`api/news.py`
- 函数名：`get_scenic_info`
- 响应参数：`scenic_name`: 景点名称
- 响应: 返回景点信息

  ### 7.5 花卉信息获取
- 描述：实现城市天气查询
- 文件目录：`api/news.py`
- 函数名：`get_flower_info`
- 响应参数：`flower_name`: 花朵名称
- 响应: 返回花卉信息

  ### 7.6 汇率转换
- 描述：实现汇率转换
- 文件目录：`api/news.py`
- 函数名：`get_rate_transform`
- 响应参数：
  `source_coin`: 原币名称
  `aim_coin`: 目标币名称
  `money`: 钱额
- 响应: 返回换汇率后的金额  

## 8.名言接口(MCP)
  ### 8.1 今日名言获取
- 描述：实现今日名言查询
- 文件目录：`api/saying.py`
- 函数名：`get_today_familous_saying`
- 响应: 返回今日名言列表

  ### 8.2 励志名言获取
- 描述：实现励志名言查询
- 文件目录：`api/saying.py`
- 函数名：`get_today_motivation_saying`
- 响应: 返回励志名言列表

  ### 8.3 心灵鸡汤获取
- 描述：实现今日名言查询
- 文件目录：`api/saying.py`
- 函数名：`get_today_working_saying`
- 响应: 返回心灵鸡汤列表



