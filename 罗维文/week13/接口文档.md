# 股票BI智能助手 - API接口文档

## 项目概述

该项目是一个股票BI智能助手，提供用户管理、聊天交互、数据管理和股票查询等功能。后端基于FastAPI框架开发，提供RESTful API接口供前端调用。

## 接口统计

**总计：46个接口**（32个API接口 + 14个MCP接口）

- 用户管理：7个接口
- 聊天功能：6个接口
- 数据管理：4个接口
- 股票收藏：4个接口
- MCP协议接口：14个接口（运行在8900端口，支持SSE模式）
- 股票行情API：10个接口（双重用途接口，挂载在 `/stock`路径下）

## 基础URL

```
http://localhost:8000
```

## 1. 系统健康检查

### 1.1 健康状态检查

- **路径**: `/v1/healthy`
- **方法**: `GET`
- **描述**: 检查系统服务是否正常运行
- **文件目录**: `main_server.py`
- **函数名**: `read_healthy`
- **响应**: 无特定返回数据

## 2. 用户管理接口

### 2.1 用户登录

- **路径**: `/v1/users/login`
- **方法**: `POST`
- **描述**: 用户登录认证
- **文件目录**: `routers/user.py`
- **函数名**: `user_login`
- **请求体**:
  ```json
  {
    "user_name": "string", // 用户名
    "password": "string"  // 密码
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 2.2 用户注册

- **路径**: `/v1/users/register`
- **方法**: `POST`
- **描述**: 新用户注册
- **文件目录**: `routers/user.py`
- **函数名**: `user_register`
- **请求体**:
  ```json
  {
    "user_name": "string", // 用户名
    "password": "string",  // 密码
    "user_role": "string"  // 用户角色
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 2.3 密码重置

- **路径**: `/v1/users/reset-password`
- **方法**: `POST`
- **描述**: 重置用户密码
- **文件目录**: `routers/user.py`
- **函数名**: `user_reset_password`
- **请求体**:
  ```json
  {
    "user_name": "string",    // 用户名
    "password": "string",     // 当前密码
    "new_password": "string"  // 新密码
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 2.4 获取用户信息

- **路径**: `/v1/users/info`
- **方法**: `POST`
- **描述**: 根据用户名获取用户信息
- **文件目录**: `routers/user.py`
- **函数名**: `user_info`
- **请求参数**:
  - `user_name`: 用户名
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {             // 用户信息
      "user_id": 0,
      "user_name": "string",
      "user_role": "string",
      "register_time": "2023-01-01T00:00:00",
      "status": true
    }
  }
  ```

### 2.5 修改用户信息

- **路径**: `/v1/users/reset-info`
- **方法**: `POST`
- **描述**: 修改用户角色或状态信息
- **文件目录**: `routers/user.py`
- **函数名**: `user_reset_info`
- **请求体**:
  ```json
  {
    "user_name": "string",  // 用户名
    "user_role": "string",  // 新用户角色（可选）
    "status": true           // 新状态（可选）
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 2.6 删除用户

- **路径**: `/v1/users/delete`
- **方法**: `POST`
- **描述**: 删除指定用户
- **文件目录**: `routers/user.py`
- **函数名**: `user_delete`
- **请求参数**:
  - `user_name`: 用户名
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 2.7 获取用户列表

- **路径**: `/v1/users/list`
- **方法**: `POST`
- **描述**: 获取所有用户列表
- **文件目录**: `routers/user.py`
- **函数名**: `user_list`
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": [             // 用户列表
      {
        "user_id": 0,
        "user_name": "string",
        "user_role": "string",
        "register_time": "2023-01-01T00:00:00",
        "status": true
      }
    ]
  }
  ```

## 3. 聊天功能接口

### 3.1 聊天交互

- **路径**: `/v1/chat/`
- **方法**: `POST`
- **描述**: 与AI进行实时聊天交互（流式响应）
- **文件目录**: `routers/chat.py`
- **函数名**: `chat`
- **请求体**:
  ```json
  {
    "content": "string",            // 用户提问内容
    "user_name": "string",         // 用户名
    "session_id": "string",        // 对话会话ID（可选）
    "task": "string",              // 对话任务（可选）
    "tools": ["string"],           // 可选工具列表（可选）
    "image_content": "string",     // 图片内容（可选）
    "file_content": "string",      // 文件内容（可选）
    "url_content": "string",       // URL内容（可选）
    "audio_content": "string",     // 音频内容（可选）
    "video_content": "string",     // 视频内容（可选）
    "vison_mode": false,            // 视觉模式（可选）
    "deepsearch_mode": false,       // 深度搜索模式（可选）
    "sql_interpreter": false,       // SQL解释器模式（可选）
    "code_interpreter": false       // 代码解释器模式（可选）
  }
  ```
- **响应**: Server-Sent Events (SSE) 流式输出

### 3.2 初始化聊天会话

- **路径**: `/v1/chat/init`
- **方法**: `POST`
- **描述**: 创建新的聊天会话
- **文件目录**: `routers/chat.py`
- **函数名**: `init_chat`
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {
      "session_id": "string"  // 生成的会话ID
    }
  }
  ```

### 3.3 获取聊天会话

- **路径**: `/v1/chat/get`
- **方法**: `POST`
- **描述**: 获取指定会话的聊天记录
- **文件目录**: `routers/chat.py`
- **函数名**: `get_chat`
- **请求参数**:
  - `session_id`: 会话ID
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": {             // 会话数据
      "session_id": "string",
      "messages": [
        {
          "message_id": 0,
          "content": "string",
          "sender": "string",
          "timestamp": "2023-01-01T00:00:00"
        }
      ]
    }
  }
  ```

### 3.4 删除聊天会话

- **路径**: `/v1/chat/delete`
- **方法**: `POST`
- **描述**: 删除指定的聊天会话
- **文件目录**: `routers/chat.py`
- **函数名**: `delete_chat`
- **请求参数**:
  - `session_id`: 会话ID
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 3.5 获取用户聊天列表

- **路径**: `/v1/chat/list`
- **方法**: `POST`
- **描述**: 获取用户的所有聊天会话列表
- **文件目录**: `routers/chat.py`
- **函数名**: `list_chat`
- **请求参数**:
  - `user_name`: 用户名
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": [             // 聊天会话列表
      {
        "session_id": "string",
        "title": "string",
        "start_time": "2023-01-01T00:00:00",
        "feedback": true,
        "feedback_time": "2023-01-01T00:00:00"
      }
    ]
  }
  ```

### 3.6 聊天反馈

- **路径**: `/v1/chat/feedback`
- **方法**: `POST`
- **描述**: 对聊天消息进行反馈评价
- **文件目录**: `routers/chat.py`
- **函数名**: `feedback_chat`
- **请求参数**:
  - `session_id`: 会话ID
  - `message_id`: 消息ID
  - `feedback`: 反馈结果（true/false）
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

## 4. 数据管理接口

### 4.1 下载数据

- **路径**: `/v1/data/download`
- **方法**: `POST`
- **描述**: 下载数据（当前未实现）
- **文件目录**: `routers/data.py`
- **函数名**: `download_data`
- **响应**: 待定

### 4.2 创建数据

- **路径**: `/v1/data/create`
- **方法**: `POST`
- **描述**: 创建数据（当前未实现）
- **文件目录**: `routers/data.py`
- **函数名**: `create_data`
- **响应**: 待定

### 4.3 上传数据

- **路径**: `/v1/data/upload`
- **方法**: `POST`
- **描述**: 上传数据（当前未实现）
- **文件目录**: `routers/data.py`
- **函数名**: `upload_data`
- **响应**: 待定

### 4.4 删除数据

- **路径**: `/v1/data/delete`
- **方法**: `POST`
- **描述**: 删除数据（当前未实现）
- **文件目录**: `routers/data.py`
- **函数名**: `delete_data`
- **响应**: 待定

## 5. 股票收藏接口

### 5.1 获取用户收藏股票列表

- **路径**: `/v1/stock/list_fav_stock`
- **方法**: `POST`
- **描述**: 获取用户收藏的所有股票
- **文件目录**: `routers/stock.py`
- **函数名**: `get_user_all_stock`
- **请求参数**:
  - `user_name`: 用户名
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": [             // 收藏的股票列表
      {
        "stock_code": "string",
        "create_time": "2023-01-01T00:00:00"
      }
    ]
  }
  ```

### 5.2 删除收藏股票

- **路径**: `/v1/stock/del_fav_stock`
- **方法**: `POST`
- **描述**: 从收藏列表中删除指定股票
- **文件目录**: `routers/stock.py`
- **函数名**: `delete_user_stock`
- **请求参数**:
  - `user_name`: 用户名
  - `stock_code`: 股票代码
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 5.3 添加收藏股票

- **路径**: `/v1/stock/add_fav_stock`
- **方法**: `POST`
- **描述**: 添加股票到收藏列表
- **文件目录**: `routers/stock.py`
- **函数名**: `add_user_stock`
- **请求参数**:
  - `user_name`: 用户名
  - `stock_code`: 股票代码
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```

### 5.4 清空收藏股票

- **路径**: `/v1/stock/clear_fav_stock`
- **方法**: `POST`
- **描述**: 清空用户的所有收藏股票
- **文件目录**: `routers/stock.py`
- **函数名**: `clear_user_stock`
- **请求参数**:
  - `user_name`: 用户名
- **响应**:
  ```json
  {
    "code": 200,           // 状态码
    "message": "string",  // 响应消息
    "data": []            // 响应数据
  }
  ```



## 6. MCP协议接口

MCP协议接口是用于AI应用调用外部工具的标准协议接口，运行在8900端口，支持SSE模式。主要包括新闻、名言语录、工具类接口和股票行情API。

### 6.1 新闻相关接口

#### 6.1.1 获取今日日报新闻
- **工具名称**: `get_today_daily_news`
- **描述**: 从外部API获取今日日报新闻列表
- **文件目录**: `api/news.py`
- **函数名**: `get_today_daily_news`
- **请求参数**: 无
- **响应**: 新闻列表数组

#### 6.1.2 获取抖音热门话题
- **工具名称**: `get_douyin_hot_news`
- **描述**: 从API获取抖音热门话题或新闻
- **文件目录**: `api/news.py`
- **函数名**: `get_douyin_hot_news`
- **请求参数**: 无
- **响应**: 热门话题列表数组

#### 6.1.3 获取GitHub热门项目
- **工具名称**: `get_github_hot_news`
- **描述**: 从API获取GitHub上的热门仓库/项目
- **文件目录**: `api/news.py`
- **函数名**: `get_github_hot_news`
- **请求参数**: 无
- **响应**: 热门项目列表数组

#### 6.1.4 获取今日头条热门新闻
- **工具名称**: `get_toutiao_hot_news`
- **描述**: 从API获取今日头条平台的热门新闻标题
- **文件目录**: `api/news.py`
- **函数名**: `get_toutiao_hot_news`
- **请求参数**: 无
- **响应**: 热门新闻列表数组

#### 6.1.5 获取体育/电竞新闻
- **工具名称**: `get_sports_news`
- **描述**: 从外部API获取电竞或一般体育新闻
- **文件目录**: `api/news.py`
- **函数名**: `get_sports_news`
- **请求参数**: 无
- **响应**: 新闻列表数组

### 6.2 名言语录相关接口

#### 6.2.1 获取今日名人名言
- **工具名称**: `get_today_familous_saying`
- **描述**: 从外部API获取随机的名人名言或'一言'语录
- **文件目录**: `api/saying.py`
- **函数名**: `get_today_familous_saying`
- **请求参数**: 无
- **响应**: 名言文本

#### 6.2.2 获取今日励志语录
- **工具名称**: `get_today_motivation_saying`
- **描述**: 从API获取励志语录或励志名言
- **文件目录**: `api/saying.py`
- **函数名**: `get_today_motivation_saying`
- **请求参数**: 无
- **响应**: 励志语录结果

#### 6.2.3 获取今日工作鸡汤
- **工具名称**: `get_today_working_saying`
- **描述**: 获取与工作相关的语录或心灵鸡汤内容
- **文件目录**: `api/saying.py`
- **函数名**: `get_today_working_saying`
- **请求参数**: 无
- **响应**: 鸡汤内容文本

### 6.3 工具类接口

#### 6.3.1 获取城市天气
- **工具名称**: `get_city_weather`
- **描述**: 使用城市拼音名称获取当前天气数据
- **文件目录**: `api/tool.py`
- **函数名**: `get_city_weather`
- **请求参数**:
  - `city_name`: 城市拼音名称（如'beijing'或'shanghai'）
- **响应**: 天气数据对象

#### 6.3.2 获取地址详情
- **工具名称**: `get_address_detail`
- **描述**: 解析原始地址字符串，提取详细组成部分（省、市、区等）
- **文件目录**: `api/tool.py`
- **函数名**: `get_address_detail`
- **请求参数**:
  - `address_text`: 城市名称
- **响应**: 地址详情解析结果

#### 6.3.3 获取电话号码信息
- **工具名称**: `get_tel_info`
- **描述**: 获取给定电话号码的基本信息（位置、运营商）
- **文件目录**: `api/tool.py`
- **函数名**: `get_tel_info`
- **请求参数**:
  - `tel_no`: 电话号码
- **响应**: 电话号码信息结果

#### 6.3.4 获取景点信息
- **工具名称**: `get_scenic_info`
- **描述**: 搜索并检索特定景点或旅游景点的信息
- **文件目录**: `api/tool.py`
- **函数名**: `get_scenic_info`
- **请求参数**:
  - `scenic_name`: 景点/旅游地点名称
- **响应**: 景点列表数组

#### 6.3.5 获取花卉信息
- **工具名称**: `get_flower_info`
- **描述**: 获取给定花卉名称的花语和详情
- **文件目录**: `api/tool.py`
- **函数名**: `get_flower_info`
- **请求参数**:
  - `flower_name`: 花卉名称
- **响应**: 花卉信息结果

#### 6.3.6 获取货币汇率转换
- **工具名称**: `get_rate_transform`
- **描述**: 计算两种指定货币之间的汇率转换金额
- **文件目录**: `api/tool.py`
- **函数名**: `get_rate_transform`
- **请求参数**:
  - `source_coin`: 源货币的三字母代码（如USD、CNY）
  - `aim_coin`: 目标货币的三字母代码（如EUR、JPY）
  - `money`: 要转换的金额
- **响应**: 转换后的金额

### 6.4 其他MCP工具接口

## 7. 股票行情API（双重用途接口）

> **重要说明**: 股票行情API实现了独特的双重用途机制：
> 1. **HTTP接口用途**：作为FastAPI接口提供RESTful API服务，通过 `/stock` 路径前缀访问
> 2. **MCP工具用途**：作为MCP工具供AI智能体调用，通过`operation_id`参数指定工具名称
> 3. **集成方式**：通过`FastMCP.from_fastapi()`方法将FastAPI应用无缝转换为MCP工具服务器
> 
> 这种设计实现了代码复用，同时服务于传统HTTP客户端和AI Agent应用，提高了系统架构的灵活性和扩展性。

### 7.1 获取股票代码列表
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_stock_codes`
- **HTTP路径**: `/stock/get_stock_code`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_all_stock_code`
- **MCP操作ID**: `get_stock_codes`
- **描述**: 获取所有股票列表，支持通过关键词对股票代码和名称进行模糊查询
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `keyword` (string, 可选): 搜索关键词，用于模糊匹配股票代码或名称
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 股票列表数据
      {
        "code": "000001",        // 股票代码
        "name": "平安银行",       // 股票名称
        "industry": "银行"        // 所属行业
      },
      ...
    ]
  }
  ```
- **错误响应示例**:
  ```json
  {
    "code": 500,                  // 错误状态码
    "message": "请求超时或服务器错误",  // 错误消息
    "data": []                   // 空数据
  }
  ```

### 7.2 获取指数代码列表
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_index_code`
- **HTTP路径**: `/stock/get_index_code`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_all_index_code`
- **MCP操作ID**: `get_index_code`
- **描述**: 获取所有股票指数列表，包括上证指数、深证成指等主要指数
- **文件位置**: `api/autostock.py`
- **请求参数**: 无
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 指数列表数据
      {
        "code": "000001.SH",     // 指数代码（含市场标识）
        "name": "上证指数"        // 指数名称
      },
      ...
    ]
  }
  ```

### 7.3 获取行业代码列表
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_industry_code`
- **HTTP路径**: `/stock/get_industry_code`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_industry_code`
- **MCP操作ID**: `get_industry_code`
- **描述**: 获取所有股票行业/板块代码列表，用于行业分析和筛选
- **文件位置**: `api/autostock.py`
- **请求参数**: 无
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 行业列表数据
      {
        "code": "BK0001",        // 行业代码
        "name": "银行"            // 行业名称
      },
      ...
    ]
  }
  ```

### 7.4 获取大盘信息
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_board_info`
- **HTTP路径**: `/stock/get_board_info`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_board_info`
- **MCP操作ID**: `get_board_info`
- **描述**: 获取主要大盘指数的实时行情数据，包括开盘价、收盘价、最高价、最低价和成交量等信息
- **文件位置**: `api/autostock.py`
- **请求参数**: 无
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 大盘数据列表
      {
        "code": "000001.SH",     // 指数代码
        "name": "上证指数",       // 指数名称
        "open": 3200.00,          // 开盘价
        "close": 3210.50,         // 收盘价
        "high": 3220.00,          // 最高价
        "low": 3195.00,           // 最低价
        "volume": 25000000000,    // 成交量
        "amount": 300000000000,   // 成交额
        "change": 10.50,          // 涨跌额
        "change_percent": 0.33    // 涨跌幅
      },
      ...
    ]
  }
  ```

### 7.5 获取股票实时行情
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_stock_quote`
- **HTTP路径**: `/stock/get_stock_quote`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_quote`
- **MCP操作ID**: `get_stock_quote`
- **描述**: 获取指定股票的实时行情数据
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `code` (string, 必填): 股票代码
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": {
      "code": "000001",          // 股票代码
      "name": "平安银行",         // 股票名称
      "current": 12.50,           // 当前价格
      "open": 12.40,              // 开盘价
      "high": 12.60,              // 最高价
      "low": 12.35,               // 最低价
      "pre_close": 12.38,         // 昨收价
      "volume": 100000000,        // 成交量
      "amount": 1250000000,       // 成交额
      "change": 0.12,             // 涨跌额
      "change_percent": 0.97      // 涨跌幅
    }
  }
  ```

### 7.6 获取股票历史行情
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_stock_history`
- **HTTP路径**: `/stock/get_stock_history`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_history`
- **MCP操作ID**: `get_stock_history`
- **描述**: 获取指定股票的历史行情数据
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `code` (string, 必填): 股票代码
  - `start_date` (string, 必填): 开始日期，格式：YYYY-MM-DD
  - `end_date` (string, 必填): 结束日期，格式：YYYY-MM-DD
  - `freq` (string, 可选): 数据频率，可选值：daily, weekly, monthly
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 历史行情数据列表
      {
        "date": "2023-05-01",    // 日期
        "open": 12.40,            // 开盘价
        "close": 12.50,           // 收盘价
        "high": 12.60,            // 最高价
        "low": 12.35,             // 最低价
        "volume": 100000000,      // 成交量
        "amount": 1250000000      // 成交额
      },
      ...
    ]
  }
  ```

### 7.7 获取指数历史行情
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_index_history`
- **HTTP路径**: `/stock/get_index_history`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_index_history`
- **MCP操作ID**: `get_index_history`
- **描述**: 获取指定指数的历史行情数据
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `code` (string, 必填): 指数代码
  - `start_date` (string, 必填): 开始日期，格式：YYYY-MM-DD
  - `end_date` (string, 必填): 结束日期，格式：YYYY-MM-DD
  - `freq` (string, 可选): 数据频率，可选值：daily, weekly, monthly
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 历史行情数据列表
      {
        "date": "2023-05-01",    // 日期
        "open": 3200.00,          // 开盘价
        "close": 3210.50,         // 收盘价
        "high": 3220.00,          // 最高价
        "low": 3195.00,           // 最低价
        "volume": 25000000000,    // 成交量
        "amount": 300000000000    // 成交额
      },
      ...
    ]
  }
  ```

### 7.8 获取股票基本面信息
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_stock_basic_info`
- **HTTP路径**: `/stock/get_stock_basic_info`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_basic_info`
- **MCP操作ID**: `get_stock_basic_info`
- **描述**: 获取指定股票的基本面信息，包括公司概况、财务指标等
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `code` (string, 必填): 股票代码
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": {
      "code": "000001",          // 股票代码
      "name": "平安银行",         // 股票名称
      "industry": "银行",         // 所属行业
      "pe": 4.85,                // 市盈率
      "pb": 0.62,                // 市净率
      "total_market_cap": 242500000000, // 总市值
      "circulating_market_cap": 242500000000, // 流通市值
      "eps": 2.58,               // 每股收益
      "business_scope": "经有关机构批准的银行业务" // 经营范围
    }
  }
  ```

### 7.9 获取行业板块行情
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_industry_quote`
- **HTTP路径**: `/stock/get_industry_quote`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_industry_quote`
- **MCP操作ID**: `get_industry_quote`
- **描述**: 获取指定行业板块的实时行情数据
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `industry_code` (string, 必填): 行业代码
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": {
      "industry_code": "BK0001", // 行业代码
      "industry_name": "银行",    // 行业名称
      "current": 10000.00,       // 当前指数
      "open": 9950.00,           // 开盘指数
      "high": 10050.00,          // 最高指数
      "low": 9930.00,            // 最低指数
      "pre_close": 9900.00,      // 昨收指数
      "volume": 50000000000,     // 成交量
      "amount": 600000000000,    // 成交额
      "change": 100.00,          // 涨跌额
      "change_percent": 1.01     // 涨跌幅
    }
  }
  ```

### 7.10 获取股票分时数据
- **接口类型**: HTTP接口 + MCP工具
- **MCP工具名称**: `get_stock_minute_data`
- **HTTP路径**: `/stock/get_stock_minute_data`
- **HTTP方法**: `GET`
- **FastAPI函数名**: `get_stock_minute_data`
- **MCP操作ID**: `get_stock_minute_data`
- **描述**: 获取指定股票的实时分时交易数据，按分钟级别展示价格和成交量变化
- **文件位置**: `api/autostock.py`
- **请求参数**:
  - `code` (string, 必填): 股票代码
- **响应格式**:
  ```json
  {
    "code": 200,                  // 状态码
    "message": "success",        // 响应消息
    "data": [                    // 分时数据列表
      {
        "time": "09:30",          // 时间（HH:MM格式）
        "price": 12.10,           // 价格
        "volume": 100000          // 成交量
      },
      ...
    ]
  }
  ```
## 8. 响应数据结构

### 8.1 基本响应结构
```json
{
  "code": 200,           // 状态码
  "message": "string",  // 响应消息
  "data": []            // 响应数据（根据接口不同而变化）
}
```

### 8.2 状态码说明

- **200**: 请求成功
- **400**: 请求参数错误或业务逻辑错误
- **404**: 请求资源不存在
- **500**: 服务器内部错误

## 9. 错误处理

所有接口都包含错误处理机制，当发生异常时，会返回包含错误信息的响应：

```json
{
  "code": 500,           // 错误状态码
  "message": "错误详情",  // 错误信息
  "data": []            // 空数据
}
```

## 10. 接口安全性

目前接口设计中暂未包含认证令牌（token）机制。在生产环境中，建议添加JWT或其他认证机制来保护接口安全。

## 11. 部署说明

项目使用FastAPI框架开发，可以通过以下命令启动服务：

```bash
# 启动主服务器（用户管理、聊天功能、数据管理、股票收藏等接口）
python main_server.py
# 启动MCP工具服务器（新闻、名言语录、工具类接口和股票行情API）
python main_mcp.py
# 启动Streamlit演示界面
streamlit run .\streamlit_demo.py
```

- 主服务默认运行在 `http://localhost:8000`
- MCP服务默认运行在 `http://localhost:8900`
- 股票行情API通过路径前缀 `/stock` 挂载

### 双重用途接口说明

系统中部分接口实现了双重用途机制，特别是股票行情API（参见第6节），它们可以：
1. **作为HTTP接口**：通过FastAPI框架提供RESTful API服务
2. **作为MCP工具**：通过`FastMCP.from_fastapi()`方法将FastAPI应用转换为MCP工具服务器

这种设计提高了代码复用性和系统灵活性，使相同的业务逻辑可以同时服务于传统HTTP客户端和AI Agent应用。
