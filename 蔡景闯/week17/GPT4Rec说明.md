# GPT4Rec 推荐系统操作流程

**1. 输入用户历史交互记录**

* 获取目标用户 u 的历史交互物品列表。
* 1.2. 仅使用这些物品的原始标题文本。
  **2. 构造提示词**
  将历史物品标题按固定模板拼接成自然语言句子，例如：

> “Previously, the customer has bought: [Item1]. [Item2]. ... In the future, the customer wants to buy”

**3. 生成多条搜索查询（Query Generation）**

* 将上述 prompt 输入到大模型中。
* 使用 Beam Search（束搜索）生成 m 条不同的后续文本（即“假设性搜索查询”）。
* 每条生成结果代表用户可能在未来使用的搜索词（如 “wireless noise-cancelling headphones”）。

**4. BM25 检索**

* 将每条生成的查询送入 BM25 检索器。
* BM25 在全量物品标题库中检索与该查询最相关的物品，返回排序列表。

**5. 融合多查询的检索结果**

* 按照生成查询的语言模型概率得分从高到低排序。
* 依次从每个查询的 BM25 结果中选取 top 物品，跳过重复项。
* 直到累积获得 K 个唯一推荐物品。

**6. 输出最终推荐列表**

* 返回这 K 个物品作为给该用户的推荐结果。
