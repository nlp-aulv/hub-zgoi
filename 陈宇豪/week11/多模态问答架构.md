# 多模态RAG项目

## 目录
- [数据管理接口文档](#数据管理接口文档)
- [多模态检索和问答接口定义](#多模态检索和问答接口定义)
- [架构设计](#架构设计)
  - [数据库设计](#数据库设计)
    - [Milvus 向量数据库](#milvus-向量数据库)
    - [MySQL 关系型数据库](#mysql-关系型数据库)
    - [OSS 对象存储服务](#oss-对象存储服务)

## 数据管理接口文档

| 接口 | 入参 | 出参 | 功能 |
|------|------|------|------|
| `upLoadImage` | image or images | 是否成功 | 上传图片<br>• 元数据保存在 `mysql`<br>• 实际图片数据保存在 `oss` 云端<br>• 图片同时进行向量化（使用 `VIT` 或者 `clip`）保存在 `milvus`<br>• 要保证数据的一致性 |
| `upLoadText` | 文档 | - | `chunk` 划分，文字进行段落或者其他方式划分，有重叠，图片单独作为一个 `chunk` 进行向量化存储 |
| `uploadImageText` | 上传图文对 | 是否成功 | 文件和图片分别都用 `clip` 进行向量化并进行分开存储<br>• 文字存文字的向量库<br>• 图片存图片的向量库 |

---

## 多模态检索和问答接口定义

| 接口 | 入参 | 出参 | 功能 |
|------|------|------|------|
| `getImageByText` | text | image | 文字找向量库中最相似的图片<br>• 文字使用 BERT 向量化<br>• 使用 `milvus` 自带的余弦相似度在图片向量库中找到最合适的图片或者几张图片 |
| `descImage` | image | text | 根据图片向量在文字中寻找最合适的文字对 |
| `getSimilarImage` | image | List&lt;image&gt; | 直接向量化搜索图向量库找最相似的图片 |
| `getSimilarText` | text | text | 找相关的知识 |
| `quiz` | text | pdf | 进行知识问答：<br>1. 将文字向量化之后去文档中寻找合适的资料，在图片中寻找合适的图片，同时寻找描述图片的文字对<br>2. 填充提示词，大概是文档如下，可用的图片如下，后面追加每张图的描述信息，让 `LLM`（`qwen3AL`）基于知识库进行回答，如果需要展示图片需要告诉系统图片插入的位置<br>3. 将信息给到 `LLM` 等待回答数据<br>```json<br>{"text":"string ${image1}","image1":"string"}<br>```<br>4. 根据大模型回答的数据将图片进行填充最终输出为一个 `pdf` 发送给前端 |
| `quizByImg` | {"queryText":"text","image"} | pdf | 1. text 和 `img` 进行向量化<br>2. 单独对当前 `img` 进行文字匹配，不再去向量库寻找相似图片<br>3. 后续步骤和 `quiz` 一致 |

## 架构设计
![系统架构图](./img.png)

### 数据库设计

#### Milvus 向量数据库

##### 文字知识库向量库
- 用途: 存储上传文档中的 chunk 的向量表示

##### 图片向量库
- 用途: 存储上传图片的向量化结果

##### 图片描述向量库
- 用途: 存储图片描述文字的向量化结果，用于后续通过图片查询其对应的文字描述

#### MySQL 关系型数据库
- 职责: 存储各类资源的元信息，例如图片大小、OSS 中的实际路径、所属的知识库 ID 等

#### OSS 对象存储服务
- 职责: 存储用户上传的所有原始图片文件